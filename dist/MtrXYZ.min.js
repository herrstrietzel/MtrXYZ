!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).MtrXYZ={})}(this,(function(e){"use strict";function t({transforms:e=[],transFormOrigin:t={x:0,y:0},perspectiveOrigin:s={x:0,y:0},perspective:a=100,force3D:o=!1}={}){let l;return l=!!o||i(e)?r(e,t):n(e,t),l}function r(e=[],t={x:0,y:0}){const r=(e,t)=>({a:e.a*t.a+e.b*t.e+e.c*t.i+e.d*t.m,b:e.a*t.b+e.b*t.f+e.c*t.j+e.d*t.n,c:e.a*t.c+e.b*t.g+e.c*t.k+e.d*t.o,d:e.a*t.d+e.b*t.h+e.c*t.l+e.d*t.p,e:e.e*t.a+e.f*t.e+e.g*t.i+e.h*t.m,f:e.e*t.b+e.f*t.f+e.g*t.j+e.h*t.n,g:e.e*t.c+e.f*t.g+e.g*t.k+e.h*t.o,h:e.e*t.d+e.f*t.h+e.g*t.l+e.h*t.p,i:e.i*t.a+e.j*t.e+e.k*t.i+e.l*t.m,j:e.i*t.b+e.j*t.f+e.k*t.j+e.l*t.n,k:e.i*t.c+e.j*t.g+e.k*t.k+e.l*t.o,l:e.i*t.d+e.j*t.h+e.k*t.l+e.l*t.p,m:e.m*t.a+e.n*t.e+e.o*t.i+e.p*t.m,n:e.m*t.b+e.n*t.f+e.o*t.j+e.p*t.n,o:e.m*t.c+e.n*t.g+e.o*t.k+e.p*t.o,p:e.m*t.d+e.n*t.h+e.o*t.l+e.p*t.p}),n=(e,t,r=0)=>({a:1,b:0,c:0,d:0,e:0,f:1,g:0,h:0,i:0,j:0,k:1,l:0,m:e,n:t,o:r,p:1}),i=(e,t)=>{const r=e=>e*Math.PI/180;let n,i,s,a=r(e);switch("rx"===t||"ry"===t||"rz"===t?(n=Math.cos(a),i=Math.sin(a)):s=Math.tan(r(e)),t){case"rx":return{a:1,b:0,c:0,d:0,e:0,f:n,g:i,h:0,i:0,j:-i,k:n,l:0,m:0,n:0,o:0,p:1};case"ry":return{a:n,b:0,c:-i,d:0,e:0,f:1,g:0,h:0,i:i,j:0,k:n,l:0,m:0,n:0,o:0,p:1};case"rz":return{a:n,b:i,c:0,d:0,e:-i,f:n,g:0,h:0,i:0,j:0,k:1,l:0,m:0,n:0,o:0,p:1};case"sx":return{a:1,b:0,c:0,d:0,e:s,f:1,g:0,h:0,i:0,j:0,k:1,l:0,m:0,n:0,o:0,p:1};case"sy":return{a:1,b:s,c:0,d:0,e:0,f:1,g:0,h:0,i:0,j:0,k:1,l:0,m:0,n:0,o:0,p:1}}};let s={a:1,b:0,c:0,d:0,e:0,f:1,g:0,h:0,i:0,j:0,k:1,l:0,m:0,n:0,o:0,p:1};0===t.x&&0===t.y||(s=r(s,n(-t.x,-t.y)));for(let t=e.length-1;t>=0;t--){let a,o,l,c=e[t],f=Object.keys(c)[0],p=c[f];if("scale"===f)[a,o=1,l=1]=p,1===a&&1===o||(s=r(s,{a:a,b:0,c:0,d:0,e:0,f:o,g:0,h:0,i:0,j:0,k:l,l:0,m:0,n:0,o:0,p:1}));else if("skew"===f)[a=0,o=0]=p,o&&(s=r(s,i(o,"sy"))),a&&(s=r(s,i(a,"sx")));else if("rotate"===f)1===p.length&&(p=[0,0,p[0]]),[a=0,o=0,l=0]=p,l&&(s=r(s,i(l,"rz"))),o&&(s=r(s,i(o,"ry"))),a&&(s=r(s,i(a,"rx")));else if("translate"===f)[a,o=0,l=0]=p,(a||o||l)&&(s=r(s,n(a,o,l)));else{if("matrix"!==f)throw new Error("Unknown transform type: "+f);{let e=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p"],t=Object.fromEntries(e.map(((e,t)=>[e,p[t]])));s=r(s,t)}}}return(t.x||t.y)&&(s=r(s,n(t.x,t.y))),s}function n(e=[],t={x:0,y:0}){const r=(e,t)=>({a:e.a*t.a+e.c*t.b,b:e.b*t.a+e.d*t.b,c:e.a*t.c+e.c*t.d,d:e.b*t.c+e.d*t.d,e:e.a*t.e+e.c*t.f+e.e,f:e.b*t.e+e.d*t.f+e.f}),n=(e,t)=>({a:1,b:0,c:0,d:1,e:e,f:t}),i=(e,t)=>({a:e,b:0,c:0,d:t,e:0,f:0}),s=(e,t)=>{let[r,n]=e.map((e=>e*Math.PI/180)),i={};if("rot"===t){let e=Math.cos(r),t=Math.sin(r);i={a:e,b:t,c:-t,d:e,e:0,f:0}}else if("skew"===t){let e=Math.tan(r);i={a:1,b:Math.tan(n),c:e,d:1,e:0,f:0}}return i};let a={a:1,b:0,c:0,d:1,e:0,f:0};0===t.x&&0===t.y||(a=r(a,n(t.x,t.y)));const o={translate:[0,0],scale:[1,1],skew:[0,0],rotate:[0],matrix:[1,0,0,1,0,0]};for(const t of e){const e=Object.keys(t)[0],l=t[e]||o[e];let[c,f=o[e][1]]=l;switch("rotate"===e&&3===l.length&&(c=l[2]),e){case"matrix":let t=["a","b","c","d","e","f"];a=r(a,Object.fromEntries(t.map(((e,t)=>[e,l[t]]))));break;case"translate":(c||f)&&(a=r(a,n(c,f)));break;case"skew":(c||f)&&(a=r(a,s([c,f],"skew")));break;case"rotate":c&&(a=r(a,s([c],"rot")));break;case"scale":1===c&&1===f||(a=r(a,i(c,f)));break;default:throw new Error(`Unknown transformation type: ${e}`)}}return 0===t.x&&0===t.y||(a=r(a,n(-t.x,-t.y))),a}function i(e,t=!1){if(t)return!0;let r=!1;if(e.filter((e=>Object.keys(e).length>1)).length>1)for(let e=0;e<singleTransforms.length&&!r;e++){let t=singleTransforms[e],n=Object.keys(t),i=Object.values(t);for(let e=0;e<i.length&&!r;e++){let t=i[e],s=n[e];("matrix"!==s&&t.length>2||"matrix"===s&&16===t.length)&&(r=!0)}}else r=e.filter((e=>{let t=Object.keys(e)[0],r=Object.values(e)[0],n="rotate"===t&&3===r.length&&(0!==r[0]||0!==r[1]),i="rotate"===t&&3===r.length&&0===r[0]&&0===r[1]&&0!==r[2];return!!n||!i&&("matrix"!==t&&r.length>2&&("scale"!==t&&0!==r[2]||"scale"===t&&1!==r[2]||"rotate"===t&&0!==r[0])||"matrix"===t&&16===r.length)})).length>0;return r}function s(e){let t=[e.a,e.e,e.i],r=[e.b,e.f,e.j],n=[e.c,e.g,e.k],i=t[0]*n[0]+t[1]*n[1]+t[2]*n[2],s=r[0]*n[0]+r[1]*n[1]+r[2]*n[2],a=0===n[0]&&0===n[1];return Math.abs(i)<1e-6&&Math.abs(s)<1e-6&&a}function a(e,t=1/0){let r=1;return t!==1/0&&0!==e.o&&(r=1/(1-e.o/t),r=Math.max(.1,Math.min(r,10))),{a:e.a*r,b:e.b*r,c:e.e*r,d:e.f*r,e:e.m*r,f:e.n*r}}function o(e,t,r={x:0,y:0,z:0},n=1/0,i=null,o=-1){let f=(e=(e=>{if(void 0===e[0].x){if(Array.isArray(e[0]))return e.map((e=>({x:e[0],y:e[1]})));{let t=[];for(let r=1,n=e.length;r<n;r+=2)t.push({x:e[r-1],y:e[r]});return t}}return e})(e))[0].hasOwnProperty("z"),p=!1;(i=16===Object.values(t).length)&&!f&&(p=s(t),p&&(i=!1,t=a(t,n)));let h=[];for(let s=0,a=e.length;s<a;s++){let a=e[s];a=i?l(a,t,r,n,o):c(a,t,o),h.push(a)}return h}function l(e,t,r={x:0,y:0},n=1/0,i=-1){let s=e.x,a=e.y,o=e.z||0,l=t.a*s+t.e*a+t.i*o+1*t.m,c=t.b*s+t.f*a+t.j*o+1*t.n,f=t.c*s+t.g*a+t.k*o+1*t.o,p=t.d*s+t.h*a+t.l*o+1*t.p;if(0!==p&&(l/=p,c/=p,f/=p),n!==1/0){let e=1-f/n,t=(l-r.x)/e,i=(c-r.y)/e;0!==e&&(l=r.x+t,c=r.y+i,0===e&&(e=.01),e<0&&(e=Math.abs(e),l=r.x-(l-r.x)/e,c=r.y-(c-r.y)/e))}let h={x:l,y:c};return i>-1&&(h.x=+h.x.toFixed(i),h.y=+h.y.toFixed(i)),h}function c(e,t,r=-1){let{a:n,b:i,c:s,d:a,e:o,f:l}=t,{x:c,y:f}=e,p={x:n*c+s*f+o,y:i*c+a*f+l};return r>-1&&(p.x=+p.x.toFixed(r),p.y=+p.y.toFixed(r)),p}function f({transforms:e=[],transFormOrigin:t={x:0,y:0},perspectiveOrigin:r={x:0,y:0},perspective:n=100}={}){let i=[],s=e.filter((e=>{let t=Object.keys(e)[0],r=Object.values(e)[0];return"matrix"!==t&&r.length>2||"matrix"===t&&16===r.length})).length>0,a="px";e.forEach((e=>{let t=Object.keys(e)[0],r=Object.values(e)[0];a="rotate"===t||"skew"===t?"deg":"scale"===t||"matrix"===t?"":"px";let n=r.map(((e,t)=>""!==e?`${e}${a}`:""));if(s){let e,r,s;"translate"===t?[e,r="0px",s="0px"]=n:[e,r="0deg",s="0deg"]=n,"matrix"===t?i.push(`${t}3d(${n.join(",")})`):"skew"===t?i.push(`${t}X(${e}) ${t}Y(${r})`):i.push(`${t}X(${e}) ${t}Y(${r}) ${t}Z(${s})`)}else i.push(`${t}(${n.join(", ")})`)}));let o=`perspective-origin:${r.x}px ${r.y}px; perspective:${n}px;`;return i=`transform:${i.join(" ")};transform-origin:${t.x}px ${t.y}px;`,{el:i,parent:o}}function p({transforms:e=[],transFormOrigin:r={x:0,y:0},perspectiveOrigin:n={x:0,y:0},perspective:i=100,force3D:s=!1}={}){this.transforms=e,this.transFormOrigin=r,this.perspectiveOrigin=n,this.perspective=i,this.force3D=s,this.matrix=t({transforms:e,transFormOrigin:r,perspectiveOrigin:n,perspective:i,force3D:s}),this.is3D=void 0!==this.matrix.p,this.css=f({transforms:e,transFormOrigin:r,perspectiveOrigin:n,perspective:i,force3D:s})}p.prototype.transformPoints=function(e,t=8){let r=o(e,this.matrix,this.perspectiveOrigin,this.perspective,this.force3D,t);return this.ptsT=r,r},e.Mtx=p,e.canFlattenTo2D=s,e.flattenTo2D=a,e.getCSSTransform=f,e.getMatrix=t,e.getMatrix2D=n,e.getMatrix3D=r,e.has3Dtransforms=i,e.setCSSTransforms=function(e,t){let r=f(t);e.setAttribute("style",r),e.parentNode.style.perspective=t.perspective+"px",e.parentNode.style.perspectiveOrigin=`${t.perspectiveOrigin.x}px ${t.perspectiveOrigin.y}px`},e.transformPoint=function(e,t,r={x:0,y:0},n=1/0,i=null,s=8){return e=Array.isArray(e)?{x:e[0],y:e[1],z:e[1]||0}:e,null===i&&(i=16===Object.values(t).length),e=i?l(e,t,r,n,s):c(e,t,s)},e.transformPoint2D=c,e.transformPoint3D=l,e.transformPoints=o}));
